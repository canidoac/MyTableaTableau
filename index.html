<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Table Pro</title>
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/tableau/extensions-api/lib/tableau.extensions.1.latest.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="toolbar">
            <div class="toolbar-left">
                <h1>Super Table Pro <span class="version">v4.0</span></h1>
                <!-- Indicador online configurable -->
                <span id="online-indicator" class="online-indicator">● Online</span>
                <span id="status" class="status">Conectando...</span>
            </div>
            <div class="controls">
                <div class="search-box">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="search-input" placeholder="Buscar...">
                </div>
                <select id="worksheet-selector" class="worksheet-select" style="display: none;">
                    <option>Cargando...</option>
                </select>
                <!-- Nuevo botón para gestionar columnas -->
                <button id="columns-btn" class="btn btn-secondary" title="Gestionar columnas">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Columnas
                </button>
                <button id="export-excel" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Excel
                </button>
                <button id="export-csv" class="btn btn-secondary">CSV</button>
                <button id="refresh-btn" class="btn btn-icon" title="Actualizar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                </button>
                <button id="settings-btn" class="btn btn-icon" title="Configuración">⚙️</button>
            </div>
        </header>
        
        <main class="content">
            <div id="loading" class="loading-state">
                <div class="spinner"></div>
                <p>Cargando datos...</p>
            </div>
            
            <div id="error" class="error-state" style="display: none;">
                <h3>Error</h3>
                <p id="error-message"></p>
            </div>
            
            <div id="table-container" style="display: none;">
                <div class="table-info">
                    <div class="info-row">
                        <span id="table-title" class="table-title"></span>
                        <span id="row-count" class="row-count"></span>
                    </div>
                    <div id="filter-info" class="filter-info" style="display: none;">
                        <span id="filtered-count"></span>
                        <button id="clear-filter" class="btn-link">Limpiar</button>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead id="table-header"></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
                
                <!-- Paginación -->
                <div id="pagination" class="pagination"></div>
            </div>
        </main>
    </div>
    
    <!-- Modal de configuración general -->
    <div id="settings-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Configuración</h2>
                <button class="close-modal">×</button>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="general">General</button>
                <button class="tab-btn" data-tab="row-format">Formato de Filas</button>
                <button class="tab-btn" data-tab="performance">Rendimiento</button>
            </div>
            
            <div class="modal-body">
                <div id="general-tab" class="tab-content active">
                    <h3>Opciones Generales</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-online" checked>
                        <span>Mostrar indicador "Online"</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-search" checked>
                        <span>Mostrar buscador</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-export" checked>
                        <span>Mostrar botones de exportación</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-refresh" checked>
                        <span>Mostrar botón de actualizar</span>
                    </label>
                </div>
                
                <!-- Nueva pestaña para formato de filas -->
                <div id="row-format-tab" class="tab-content">
                    <h3>Formato Condicional de Filas</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-row-format">
                        <span>Activar formato condicional de filas</span>
                    </label>
                    
                    <div class="form-group" style="margin-top: 24px;">
                        <label>Reglas de formato (pintan toda la fila):</label>
                        <div id="row-rules-list" class="rules-container"></div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Agregar nueva regla:</label>
                        <div style="display: grid; grid-template-columns: 1fr 100px 1fr; gap: 8px; margin-bottom: 8px;">
                            <select id="row-rule-column" class="form-input">
                                <option value="">Columna...</option>
                            </select>
                            <select id="row-rule-operator" class="form-input">
                                <option value="=">=</option>
                                <option value="!=">≠</option>
                                <option value="contains">Contiene</option>
                                <option value=">">></option>
                                <option value="<"><</option>
                            </select>
                            <input type="text" id="row-rule-value" placeholder="Valor..." class="form-input">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 8px;">
                            <div>
                                <label style="font-size: 12px; color: #64748b;">Color de fondo:</label>
                                <input type="color" id="row-rule-bgcolor" value="#fee2e2" class="form-input">
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #64748b;">Color de texto:</label>
                                <input type="color" id="row-rule-textcolor" value="#991b1b" class="form-input">
                            </div>
                            <button id="add-row-rule-btn" class="btn btn-primary" style="align-self: flex-end;">Agregar</button>
                        </div>
                    </div>
                </div>
                
                <div id="performance-tab" class="tab-content">
                    <h3>Rendimiento</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-virtualization" checked>
                        <span>Activar virtualización (solo renderiza filas visibles)</span>
                    </label>
                    <div class="form-group">
                        <label>Filas por página:</label>
                        <input type="number" id="settings-rows-per-page" value="100" min="10" max="1000" step="10" class="form-input">
                        <p class="help-text">Menos filas = mejor rendimiento</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="save-settings-btn" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de gestión de columnas -->
    <div id="columns-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Gestión de Columnas</h2>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <p class="help-text" style="margin-bottom: 16px;">
                    Controla qué columnas se muestran en la tabla, cuáles puede ver el usuario final, y cuáles se incluyen en la exportación.
                </p>
                <div id="columns-list" class="columns-list"></div>
            </div>
            <div class="modal-footer">
                <button onclick="saveColumnManager()" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de configuración de columna individual -->
    <div id="column-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurar: <span id="config-col-name"></span></h2>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tooltip (ayuda al pasar el mouse):</label>
                    <input type="text" id="config-col-tooltip" placeholder="Descripción de la columna..." class="form-input">
                </div>
                
                <div class="form-group">
                    <label>Tipo de formato:</label>
                    <select id="config-format-type" class="form-input">
                        <option value="text">Texto</option>
                        <option value="number">Numérico</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Reglas de formato:</label>
                    <div id="format-rules-list" class="rules-container"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveColumnConfig()" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>
